<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Setting up Gitlab CI/CD pt. 2 | JmbFountain</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Setting up Gitlab CI/CD pt. 2" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="In the last post, I left off with a half finished pipeline. Now, I finally got it working." />
<meta property="og:description" content="In the last post, I left off with a half finished pipeline. Now, I finally got it working." />
<meta property="og:site_name" content="JmbFountain" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-08-26T00:00:00+02:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Setting up Gitlab CI/CD pt. 2" />
<script type="application/ld+json">
{"description":"In the last post, I left off with a half finished pipeline. Now, I finally got it working.","@type":"BlogPosting","headline":"Setting up Gitlab CI/CD pt. 2","dateModified":"2021-08-26T00:00:00+02:00","datePublished":"2021-08-26T00:00:00+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"/blog/2021/08/26/18-03.html"},"url":"/blog/2021/08/26/18-03.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="JmbFountain" />
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">JmbFountain</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about.html">About</a><a class="page-link" href="/gallery.html">Images</a><a class="page-link" href="/pubkeys">Pubkeys</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Setting up Gitlab CI/CD pt. 2</h1>
    <p class="post-meta"><time class="dt-published" datetime="2021-08-26T00:00:00+02:00" itemprop="datePublished">
        2021-08-26-00-00
      </time>• 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">Johannes</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>In the last post, I left off with a half finished pipeline. Now, I finally got it working.</p>

<p>.gitlab-ci.yml:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">stages</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">compile</span>
    <span class="pi">-</span> <span class="s">container-build</span>

<span class="na">jekyll-build</span><span class="pi">:</span>
    <span class="na">stage</span><span class="pi">:</span> <span class="s">compile</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">jekyll/builder</span>
    <span class="na">tags</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">docker</span>
    <span class="na">script</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">cd src/</span>
        <span class="pi">-</span> <span class="s">jekyll clean</span>
        <span class="pi">-</span> <span class="s">jekyll build</span>
    <span class="na">artifacts</span><span class="pi">:</span>
        <span class="na">paths</span><span class="pi">:</span> 
            <span class="pi">-</span> <span class="s">src/_site/</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">webroot"</span>

<span class="na">container-build</span><span class="pi">:</span>
    <span class="na">stage</span><span class="pi">:</span> <span class="s">container-build</span>
    <span class="na">tags</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">docker-builder</span>
    <span class="na">dependencies</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">jekyll-build</span>
    <span class="na">before_script</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">unset cd</span>
        <span class="pi">-</span> <span class="s">docker info</span>
        <span class="pi">-</span> <span class="s">echo "$CI_DEPLOY_USER $CI_DEPLOY_PASSWORD $CI_REGISTRY"</span>
        <span class="pi">-</span> <span class="s">docker login -u $CI_DEPLOY_USER -p $CI_DEPLOY_PASSWORD $CI_REGISTRY</span>
    <span class="na">script</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">docker build -t $CI_REGISTRY/johannes/www-jmbfountain-de .</span>
        <span class="pi">-</span> <span class="s">docker push $CI_REGISTRY/johannes/www-jmbfountain-de</span>

</code></pre></div></div>

<p>So what did I do to fix this? Basically I read through the docs for login/auth for three hours and then figured out I should use a Deployment-Token called “gitlab-deploy-token”, and login using <code class="language-plaintext highlighter-rouge">docker login -u $CI_DEPLOY_USER -p $CI_DEPLOY_PASSWORD $CI_REGISTRY</code>. Now, it’s time to do the cd part of CI/CD, deploying the website to Kubernetes. However, to get that part done properly, I’ll have to first get my new network running, so there will be no more stuff like this for a while.</p>

  </div><a class="u-url" href="/blog/2021/08/26/18-03.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
        <ul class="contact-list">
          <li class="p-name">Johannes</li>
          <li><a class="u-email" href="mailto:jmb@smx.de">jmb@smx.de</a></li>
        </ul>
      </div>
      <div class="footer-col">
        <p>Website of Johannes, here I write about all sorts of stuff I usually do, along with random other stuff
</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://www.jmbfountain.de%2Fgit%2F/johannes" title="johannes"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#gitlab"></use></svg></a></li><li><a rel="me" href="https://github.com/jmbfountain" title="jmbfountain"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/jmbfountain" title="jmbfountain"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
